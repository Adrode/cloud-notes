#foreign_key #relationship #join

## Czym są relationships?
#relationship 
- **Relationship** - powiązanie logiczne między różnymi tabelami; jedna tabela zawiera kolumnę z foreign key do innej kolumny

## Jakie są typy relationships?
#relationship 
- **1:N (One-to-Many)** - jeden do wielu, np. jeden użytkownik ma wiele postów
	- w jednej tabeli mam posty, gdzie różne posty mogą wskazywać na jednego użytkownika w innej tabeli
		- czyli **tabela "Many" ma FOREIGN KEY do tabeli "One"**
	- Autor -> Książki, Kategoria -> Produkty
- **1:1 (One-to-One)** - jedna do jednej, np. jeden użytkownik ma jeden profil
	- czyli **jedna tabela ma UNIQUE REFERENCE do drugiej tabeli**
		- technicznie obojętnie, która ma reference do której, praktycznie reference powinna mieć ta tabela, która jest zależna od tej drugiej (np. profil bez usera nie ma sensu) 
	- np. rozdzielenie haseł z resztą danych na dwie tabele
	- raczej rzadko używane
- **N:N (Many-to-Many)** - wiele do wielu, np. student ma wiele kursów, kurs ma wielu studentów
	- **WYMAGA TABELI POŚREDNIEJ (junction table / pivot table)!**

## Czym są Foreign Key?
#foreign_key
- **Foreign Key** - przy relacji między tabelami (opis wyżej), kolumna zawierająca foreign keys wskazuje na primary keys z innej tabeli

## Jak dodać relationship między tabelami?
#relationship 
- **`CREATE TABLE person (..., car_id BIGINT REFERENCES car(id));`** - tworzy kolumnę `car_id`, `REFERENCES` oznacza powiązanie tej kolumny z `car(id)`, czyli z kolumną `id` z tabeli `car`

## Jak update'ować relationship?
#relationship 
- **`UPDATE person SET car_id = 1 WHERE id = 3;`** - ustawiam `car_id` na wartość 1 dla `id = 3` z `person`, czyli osoba o `id = 3`  ma przypisany samochód z tabeli `car` od `id = 1`;

## Czym jest i jak zrobić INNER JOIN?
#INNER_JOIN
- **INNER JOIN** - zwraca część wspólną dwóch tabel
	- **`SELECT * FROM person JOIN car ON person.car_id = car.id;`**
		- tabele są łączone na zasadzie warunku `ON`
		- warunek może być oparty na FOREING KEY, ale nie musi
		- w warunku `ON` musi być wskazana 1 kolumna z tabeli pierwszej i 1 kolumna z tabeli drugiej, gdzie wskazane kolumny muszą mieć pokrywające się wartości
			- w innym przypadku zostanie zwrócona pusta tabela, bo nie będzie możliwe stworzenie części wspólnej, ponieważ tabele nie mają jak się logicznie połączyć między sobą

## Czym jest i jak zrobić LEFT JOIN?
#LEFT_JOIN
- **LEFT JOIN** - zwraca wszystko z pierwszej tabeli oraz część wspólną obu tabel
	- **`SELECT * FROM person LEFT JOIN car ON car_id = car.id;`**
		- analogicznie działa **RIGHT JOIN**

## Jak usuwać wiersze, gdy są połączone przez relationship?
#relationship 
- Tabela 1 zawiera reference do tabeli 2 (np. w tabeli 1 jest kolumna `car_id`, która odnosi się do kolumny `id` z tabeli 2). W wierszu tabeli 1 o `id` = 1, `car_id` = 12, czyli jest to wiersz o `id` = 12 w tabeli 2.
	- Jeśli będę chciał usunąć z tabeli 2 wiersz o `id` = 12, to dostanę błąd ze względu na foreign key constraint
	- Muszę wtedy najpierw usunąć powiązanie, czyli albo usunąć wiersz z tabeli 1 o `id` = 1 albo usunąć z tego wiersza `car_id` = 12. Wtedy w tabeli 2 `id` = 12 jest wolne od powiązań, więc można je spokojnie usunąć.